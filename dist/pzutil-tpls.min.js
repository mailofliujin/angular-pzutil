/*
 * pzutil
 * 

 * Version: 0.0.6 - 2014-05-25
 * License: MIT
 */
angular.module("pzutil",["pzutil.tpls","pzutil.modal","pzutil.services","pzutil.simplegrid"]),angular.module("pzutil.tpls",["template/modal/modal.tpl.html","template/modal/wait.tpl.html","template/simplegrid/footer.tpl.html","template/simplegrid/header.tpl.html","template/simplegrid/simpleGrid-normal.tpl.html","template/simplegrid/simpleGrid-simple.tpl.html","template/simplegrid/simpleGrid.tpl.html"]),angular.module("pzutil.modal",[]).directive("crudModal",function(){return{restrict:"E",replace:!0,transclude:"element",templateUrl:"template/modal/modal.tpl.html"}}).factory("crudWait",["$http","$modal",function(a,b){var c={doWork:function(a,c,d){var e=b.open({templateUrl:"template/modal/wait.tpl.html",controller:"crudWaitCtrl",resolve:{msg:function(){return a}}});e.result.then(function(){},function(){}),c.then(function(){d(),e.close()})}};return c}]).controller("crudWaitCtrl",["$scope","$modalInstance","msg",function(a,b,c){a.msg=c}]),angular.module("pzutil.services",[]).factory("localizedMessages",["$interpolate","I18N.MESSAGES",function(a,b){var c=function(a,b){return a||"?"+b+"?"};return{get:function(d,e){var f=b[d];return f?a(f)(e):c(f,d)},rawGet:function(a){return b[a]}}}]).filter("i18n",["localizedMessages",function(a){return function(b){return a.get(b)}}]).directive("i18n",["localizedMessages",function(a){var b={restrict:"EAC",updateText:function(b,c){b.text(a.get(c,interpolateParams))},link:function(a,c,d){d.$observe("i18n",function(){b.updateText(c,d.i18n)})}};return b}]).directive("i18nAttr",["localize",function(a){var b={restrict:"EAC",updateText:function(b,c){b.text(a.get(c,interpolateParams))},link:function(a,c,d){d.$observe("i18nAttr",function(a){b.updateText(c,a)})}};return b}]),angular.module("pzutil.simplegrid",["pzutil.services","pzutil.modal"]).factory("sgColumn",["localizedMessages",function(a){var b=function(b){var c=b.sorter,d=b.myLookup,e=b.myLookupTitle,f=function(a){angular.extend(this,a)};return f.sorter=c,f.New=function(a){return new f(a)},f.Parse=function(a){if(a){for(var b=angular.fromJson(a),c=[],d=0;d<b.length;d++)c.push(new f(b[d]));return c}},f.prototype.$getTitle=function(){if(this.res)return a.get(this.res);var b=this.name;return e&&(b=e({col:b})),b||this.name},f.prototype.$getColumnClass=function(){var a=this.width?this.width:2;return this.align?"sg-gridrow-cell col-md-"+a+" text-"+this.align:"sg-gridrow-cell col-md-"+a},f.prototype.$sort=function(){this.sortOrder=!this.sortOrder,f.sorter(this.name,this.sortOrder)},f.prototype.$getText=function(a){var b=a[this.name];return this.bool?"":(d&&(b=d({col:this.name,value:b,item:a})),b)},f};return b}]).directive("simpleGrid",["sgColumn","breadcrumbs","localizedMessages","crudWait",function(a,b,c,d){return{restrict:"E",replace:!0,scope:{data:"=sgData",sgAddObject:"&",sgSortOptions:"=",itemtemplate:"=sgTemplate",sgColumns:"@",sgDelObject:"&",sgAllowDel:"@",sgNoPager:"=",sgOnClick:"&",sgLookup:"&",sgGlobalSearch:"@",sgPageSize:"@",sgOptions:"=",sgOnChange:"&",sgLookupTitle:"&"},templateUrl:function(a,b){var c=b.sgTemplate;if(c){var d=".grid.tpl.html'";return-1!==c.indexOf(d,c.length-d.length)?"template/simplegrid/simpleGrid-simple.tpl.html":"template/simplegrid/simpleGrid.tpl.html"}return"template/simplegrid/simpleGrid-normal.tpl.html"},link:function(e,f,g){e.sorter=function(a,b){_(e.columns).forEach(function(b){b.name!=a&&(b.sortOrder=void 0)}),e.data.sort(function(c,d){var e,f=c[a],g=d[a];return e=null==f?-1:null==g?1:g>f?-1:1,e*(b?1:-1)})},e.AddObject=function(){e.data.push(a.New(e.sgAddObject()))},e.DelObject=function(a){if(confirm(c.get("common.del"))){var b=e.data.indexOf(a);e.data.splice(b,1),e.sgDelObject&&e.sgDelObject(a)}},e.myLookup=g.sgLookup?e.sgLookup:null,e.myLookupTitle=g.sgLookupTitle?e.sgLookupTitle:null,e.columns=a(e).Parse(g.sgColumns),e.sortGrid=function(a){if(e.sgSortOptions){var b=_.find(e.sgSortOptions,{selected:!0});b&&e.sorter(b.name,a)}},e.sortGrid(!0),e.currentPage=1,e.totalItems=e.data.length,e.scrollStyle=g.gridHeight?"height:"+g.gridHeight+";overflow-y:scroll":"",e.pageSize=e.sgNoPager?100:e.sgPageSize?parseInt(e.sgPageSize):15,e.getIndex=function(a){return e.items.indexOf(a)+1},e.changed=function(a){e.currentPage=a;var f=null;e.sgGlobalSearch&&b.listingSearch&&""!=b.listingSearch?(f=_.filter(e.data,function(a){for(var c=0;c<e.columns.length;c++){var d=e.columns[c].name,f=a[d];if(e.myLookup&&(f=e.myLookup({col:d,value:f})),f&&f.toString().indexOf(b.listingSearch)>-1)return!0}return!1}),e.totalItems=f.length):f=e.data;var h=_.take(_.rest(f,(a-1)*e.pageSize),e.pageSize),i=function(){e.items?(e.items.length=0,e.items.push.apply(e.items,h)):e.items=h,e.totalItems=e.data.length,e.footer=c.get("common.totalcount",{from:e.pageSize*(e.currentPage-1)+1,to:Math.min(e.pageSize*e.currentPage,e.totalItems),total:e.totalItems}),console.info("footer",e.footer)};g.sgOnChange?d.doWork("Please wait...",e.sgOnChange({items:h}),i):i()},e.sgGlobalSearch&&e.$watch(function(){return b.listingSearch},function(){e.changed(e.currentPage)}),e.$watchCollection(function(){return e.data},function(){e.changed(e.currentPage)})}}}]),angular.module("template/modal/modal.tpl.html",[]).run(["$templateCache",function(a){a.put("template/modal/modal.tpl.html",'<div>\n    <div class="modal-header">\n        <h3>Edit {{heading()}}</h3>\n    </div>\n    <div class="modal-body">\n        <div ng-transclude></div>\n    </div>\n    <div class="modal-footer">\n        <div class="btn-toolbar page-header-ztree" role="toolbar">\n            <button type="button" class="btn btn-default"  ng-click="ok()"><i class="fa fa-save"></i> OK</button>\n            <button type="button" class="btn btn-default" ng-click="cancel()"><i class="fa fa-undo"></i> Cancel</button>\n        </div>\n    </div>\n</div>')}]),angular.module("template/modal/wait.tpl.html",[]).run(["$templateCache",function(a){a.put("template/modal/wait.tpl.html",'<div class="modal-body">\n    <div class="progress progress-striped active">\n        <div class="progress-bar"  role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">\n            {{msg}}\n        </div>\n    </div>\n</div>')}]),angular.module("template/simplegrid/footer.tpl.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/footer.tpl.html",'<div class="row">\n    <div class="col-md-9">\n        <pagination ng-if="!sgNoPager" ng-show="totalItems>pageSize"\n                    total-items="totalItems" page="currentPage" items-per-page="pageSize"\n                    max-size="5" class="pagination-sm" boundary-links="true"  on-select-page="changed(page)" />\n    </div>\n    <div class="col-md-3 sg-footer">\n        <strong>{{footer}}</strong>\n    </div>\n</div>')}]),angular.module("template/simplegrid/header.tpl.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/header.tpl.html",'<div class="row well well-sm sg-gridheader" >\n    <div class="{{col.$getColumnClass()}}" ng-repeat="col in columns">\n        <a href ng-click="col.$sort()" class="btn-header">{{col.$getTitle()}}</a>\n        <i class="fa fa-sort-desc" ng-show="col.sortOrder"></i>\n        <i class="fa fa-sort-asc" ng-show="!col.sortOrder && col.sortOrder!=undefined"></i>\n    </div>\n</div>')}]),angular.module("template/simplegrid/simpleGrid-normal.tpl.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/simpleGrid-normal.tpl.html",'<div class="sg-grid">\n    <ng-include src="\'template/simplegrid/header.tpl.html\'"></ng-include>\n    <div style="{{scrollStyle}}">\n        <div ng-repeat="item in items" class="row sg-gridrow" ng-click="sgOnClick({id: item.id})">\n            <div class="{{col.$getColumnClass()}}" ng-repeat="col in columns">\n                <i ng-if="col.bool" ng-class="{true: \'fa fa-check\'}[item[col.name]]"></i>\n                <a href ng-if="$first && sgAllowDel" ng-click="DelObject(item)"><i class= \'glyphicon glyphicon-remove\'></i></a>\n                <ng-include  ng-if="col.template" src="col.template"></ng-include>\n                <span ng-if="!col.template">{{col.$getText(item)}}</span>\n            </div>\n        </div>\n    </div>\n    <ng-include src="\'template/simplegrid/footer.tpl.html\'"></ng-include>\n</div>')}]),angular.module("template/simplegrid/simpleGrid-simple.tpl.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/simpleGrid-simple.tpl.html",'<div class="sg-grid">\n    <ng-include src="itemtemplate"></ng-include>\n    <ng-include src="\'template/simplegrid/footer.tpl.html\'"></ng-include>\n</div>')}]),angular.module("template/simplegrid/simpleGrid.tpl.html",[]).run(["$templateCache",function(a){a.put("template/simplegrid/simpleGrid.tpl.html",'<div class="form-horizontal sg-grid">\n    <div class="input-group" style="width: 320px;margin-bottom: 15px" ng-if="sgAddObject && sgSortOptions">\n        <span class="input-group-addon"><i class="fa fa-check-circle"></i></span>\n        <select class="form-control">\n            <option ng-repeat="item in sgSortOptions" ng-selected="item.selected" value="item.name">{{item.text}}</option>\n        </select>\n        <div class="input-group-btn">\n            <button type="button" class="btn btn-default" ng-click="sortGrid(true)"><i class="fa fa-sort-amount-asc"></i></button>\n            <button type="button" class="btn btn-default" ng-click="sortGrid(false)"><i class="fa fa-sort-amount-desc"></i></button>\n            <button type="button" class="btn btn-default" ng-click="sgAddObject()" ng-if="sgAddObject"><span class="glyphicon glyphicon-plus"></span></button>\n        </div>\n    </div>\n    <ng-include src="\'template/simplegrid/header.tpl.html\'" ng-if="sgColumns"></ng-include>\n    <div style="{{scrollStyle}}">\n        <div ng-repeat="item in items" style="padding: 3px 0px 3px">\n            <ng-include src="itemtemplate"></ng-include>\n        </div>\n    </div>\n    <ng-include src="\'template/simplegrid/footer.tpl.html\'"></ng-include>\n</div>')}]);